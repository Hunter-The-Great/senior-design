import SwiftUI
import Charts

struct DataPoint: Identifiable {
    let id = UUID()
    let time: Double
    let value: Double
}

func formattedDate(from timestamp: TimeInterval) -> String {
    let date = Date(timeIntervalSince1970: timestamp)
    let formatter = DateFormatter()
    formatter.dateStyle = .medium  // Example: "Mar 2, 2025"
    formatter.timeStyle = .short   // Example: "3:45 PM"
    return formatter.string(from: date)
}



struct ContentView: View {
    @State private var savedEntries: [(key: String, data: [DataPoint])] = []
    @State private var savedKeys: [String] = []
    @State private var selectedData: [DataPoint] = []
    @State private var selectedKey: String? = nil
    
    @State private var timer: Timer?
    @State private var currentIndex = 0
    
    func startTimer() {
        timer?.invalidate() // stop any existing timer
        timer = Timer.scheduledTimer(withTimeInterval: 0.00001, repeats: true) { _ in
                //data[currentIndex] = initdata[currentIndex]
                data[currentIndex] = DataPoint(time: Double(currentIndex), value: initdata[currentIndex].value)
                currentIndex += 1
                if(currentIndex == 999){
                    currentIndex = 0;
                }
        }
    }
    
    @State var data: [DataPoint] = (0..<999).map { i in
        DataPoint(time: Double(i), value: 0)
    }
    
    
    let bluetoothManager = BluetoothManager()
    
    // temp placeholder data stuff
    @State var initdata: [DataPoint] = [
           DataPoint(time: 0, value: 0.0000173245),
DataPoint(time: 1, value: 0.0000850606),
DataPoint(time: 2, value: 0.000218077),
           DataPoint(time: 3, value: 0.000256859),
           DataPoint(time: 4, value: 0.0000766278),
DataPoint(time: 5, value: -0.0000704236),
DataPoint(time: 6, value: 0.0000949987),
DataPoint(time: 7, value: 0.000338028),
DataPoint(time: 8, value: 0.000336407),
DataPoint(time: 9, value: 0.000203344),
DataPoint(time: 10, value: 0.0000845313),
DataPoint(time: 11, value: -0.0000849342),
DataPoint(time: 12, value: -0.000233101),
DataPoint(time: 13, value: -0.000217443),
DataPoint(time: 14, value: -0.00011219),
DataPoint(time: 15, value: -0.000033595),
DataPoint(time: 16, value: 0.0000170338),
DataPoint(time: 17, value: 0.0000187301),
DataPoint(time: 18, value: -0.0000581684),
DataPoint(time: 19, value: -0.000154502),
DataPoint(time: 20, value: -0.000206667),
DataPoint(time: 21, value: -0.000211641),
DataPoint(time: 22, value: -0.000173765),
DataPoint(time: 23, value: -0.000106052),
DataPoint(time: 24, value: -0.0000528001),
DataPoint(time: 25, value: -0.0000435977),
DataPoint(time: 26, value: -0.000068895),
DataPoint(time: 27, value: -0.000106222),
DataPoint(time: 28, value: -0.000131964),
DataPoint(time: 29, value: -0.000128341),
DataPoint(time: 30, value: -0.000100819),
DataPoint(time: 31, value: -0.0000715965),
DataPoint(time: 32, value: -0.00005431),
DataPoint(time: 33, value: -0.0000477088),
DataPoint(time: 34, value: -0.0000466676),
DataPoint(time: 35, value: -0.0000444366),
DataPoint(time: 36, value: -0.0000316734),
DataPoint(time: 37, value: -0.00000969814),
DataPoint(time: 38, value: 0.00000549022),
DataPoint(time: 39, value: 0.00000521369),
DataPoint(time: 40, value: -0.00000224561),
DataPoint(time: 41, value: -0.00000931752),
DataPoint(time: 42, value: -0.0000138899),
DataPoint(time: 43, value: -0.00000674309),
DataPoint(time: 44, value: 0.0000189701),
DataPoint(time: 45, value: 0.0000468568),
DataPoint(time: 46, value: 0.0000531992),
DataPoint(time: 47, value: 0.0000394876),
DataPoint(time: 48, value: 0.0000211631),
DataPoint(time: 49, value: -0.00000100272),
DataPoint(time: 50, value: -0.0000241001),
DataPoint(time: 51, value: -0.0000232263),
DataPoint(time: 52, value: 0.0000133158),
DataPoint(time: 53, value: 0.0000576374),
DataPoint(time: 54, value: 0.0000786965),
DataPoint(time: 55, value: 0.0000722519),
DataPoint(time: 56, value: 0.0000437183),
DataPoint(time: 57, value: 0.00000105379),
DataPoint(time: 58, value: -0.0000324021),
DataPoint(time: 59, value: -0.0000331626),
DataPoint(time: 60, value: -0.00000254281),
DataPoint(time: 61, value: 0.0000411444),
DataPoint(time: 62, value: 0.0000783685),
DataPoint(time: 63, value: 0.0000896146),
DataPoint(time: 64, value: 0.0000641984),
DataPoint(time: 65, value: 0.0000144841),
DataPoint(time: 66, value: -0.0000297359),
DataPoint(time: 67, value: -0.0000433506),
DataPoint(time: 68, value: -0.0000225225),
DataPoint(time: 69, value: 0.0000167796),
DataPoint(time: 70, value: 0.0000518759),
DataPoint(time: 71, value: 0.0000645945),
DataPoint(time: 72, value: 0.0000501021),
DataPoint(time: 73, value: 0.0000197667),
DataPoint(time: 74, value: -0.0000113452),
DataPoint(time: 75, value: -0.0000341351),
DataPoint(time: 76, value: -0.0000374505),
DataPoint(time: 77, value: -0.0000115973),
DataPoint(time: 78, value: 0.0000292994),
DataPoint(time: 79, value: 0.0000523097),
DataPoint(time: 80, value: 0.0000428548),
DataPoint(time: 81, value: 0.0000152613),
DataPoint(time: 82, value: -0.0000139209),
DataPoint(time: 83, value: -0.000035623),
DataPoint(time: 84, value: -0.0000365277),
DataPoint(time: 85, value: -0.0000101456),
DataPoint(time: 86, value: 0.0000261224),
DataPoint(time: 87, value: 0.000048877),
DataPoint(time: 88, value: 0.0000502535),
DataPoint(time: 89, value: 0.0000312496),
DataPoint(time: 90, value: -0.00000113538),
DataPoint(time: 91, value: -0.0000266094),
DataPoint(time: 92, value: -0.0000274518),
DataPoint(time: 93, value: -0.00000834819),
DataPoint(time: 94, value: 0.0000164257),
DataPoint(time: 95, value: 0.0000393929),
DataPoint(time: 96, value: 0.0000508486),
DataPoint(time: 97, value: 0.0000389351),
DataPoint(time: 98, value: 0.0000105556),
DataPoint(time: 99, value: -0.0000133077),
DataPoint(time: 100, value: -0.0000236847),
DataPoint(time: 101, value: -0.0000200102),
DataPoint(time: 102, value: 0.00000134754),
DataPoint(time: 103, value: 0.0000296169),
DataPoint(time: 104, value: 0.0000402583),
DataPoint(time: 105, value: 0.0000294237),
DataPoint(time: 106, value: 0.0000146299),
DataPoint(time: 107, value: 0.00000175754),
DataPoint(time: 108, value: -0.0000128724),
DataPoint(time: 109, value: -0.0000205474),
DataPoint(time: 110, value: -0.000012394),
DataPoint(time: 111, value: 0.00000392897),
DataPoint(time: 112, value: 0.000016143),
DataPoint(time: 113, value: 0.0000164244),
DataPoint(time: 114, value: 0.00000168342),
DataPoint(time: 115, value: -0.0000181623),
DataPoint(time: 116, value: -0.0000278269),
DataPoint(time: 117, value: -0.0000265218),
DataPoint(time: 118, value: -0.0000202736),
DataPoint(time: 119, value: -0.00000852916),
DataPoint(time: 120, value: 0.00000429952),
DataPoint(time: 121, value: 0.00000735821),
DataPoint(time: 122, value: 0.000000167374),
DataPoint(time: 123, value: -0.00000956871),
DataPoint(time: 124, value: -0.000018351),
DataPoint(time: 125, value: -0.0000237036),
DataPoint(time: 126, value: -0.0000212571),
DataPoint(time: 127, value: -0.0000125081),
DataPoint(time: 128, value: -0.00000558957),
DataPoint(time: 129, value: -0.00000508217),
DataPoint(time: 130, value: -0.00000742801),
DataPoint(time: 131, value: -0.0000087205),
DataPoint(time: 132, value: -0.0000104523),
DataPoint(time: 133, value: -0.0000131355),
DataPoint(time: 134, value: -0.0000129526),
DataPoint(time: 135, value: -0.00000953558),
DataPoint(time: 136, value: -0.00000678109),
DataPoint(time: 137, value: -0.00000577155),
DataPoint(time: 138, value: -0.00000685723),
DataPoint(time: 139, value: -0.0000113646),
DataPoint(time: 140, value: -0.0000144397),
DataPoint(time: 141, value: -0.0000107341),
DataPoint(time: 142, value: -0.00000673781),
DataPoint(time: 143, value: -0.00000798422),
DataPoint(time: 144, value: -0.00000591291),
DataPoint(time: 145, value: 0.0000025638),
DataPoint(time: 146, value: 0.00000581522),
DataPoint(time: 147, value: 0.00000142816),
DataPoint(time: 148, value: 0.000000629038),
DataPoint(time: 149, value: 0.00000464193),
DataPoint(time: 150, value: 0.00000303784),
DataPoint(time: 151, value: -0.00000459478),
DataPoint(time: 152, value: -0.00000655355),
DataPoint(time: 153, value: -0.000000546281),
DataPoint(time: 154, value: 0.00000274521),
DataPoint(time: 155, value: 0.00000131067),
DataPoint(time: 156, value: 0.00000243158),
DataPoint(time: 157, value: 0.00000382531),
DataPoint(time: 158, value: 0.00000230904),
DataPoint(time: 159, value: 0.00000530966),
DataPoint(time: 160, value: 0.0000105485),
DataPoint(time: 161, value: 0.00000563498),
DataPoint(time: 162, value: -0.00000225445),
DataPoint(time: 163, value: 0.00000338382),
DataPoint(time: 164, value: 0.0000145357),
DataPoint(time: 165, value: 0.0000149233),
DataPoint(time: 166, value: 0.0000099108),
DataPoint(time: 167, value: 0.00000770038),
DataPoint(time: 168, value: 0.0000025431),
DataPoint(time: 169, value: -0.00000294665),
DataPoint(time: 170, value: 0.00000236212),
DataPoint(time: 171, value: 0.0000120484),
DataPoint(time: 172, value: 0.0000133282),
DataPoint(time: 173, value: 0.0000114561),
DataPoint(time: 174, value: 0.0000149184),
DataPoint(time: 175, value: 0.0000178257),
DataPoint(time: 176, value: 0.0000129998),
DataPoint(time: 177, value: 0.00000468898),
DataPoint(time: 178, value: 0.00000148962),
DataPoint(time: 179, value: 0.00000386761),
DataPoint(time: 180, value: 0.00000447099),
DataPoint(time: 181, value: 0.00000299762),
DataPoint(time: 182, value: 0.00000855666),
DataPoint(time: 183, value: 0.0000218556),
DataPoint(time: 184, value: 0.0000322032),
DataPoint(time: 185, value: 0.0000337144),
DataPoint(time: 186, value: 0.0000296712),
DataPoint(time: 187, value: 0.0000256889),
DataPoint(time: 188, value: 0.0000254777),
DataPoint(time: 189, value: 0.0000261872),
DataPoint(time: 190, value: 0.0000222237),
DataPoint(time: 191, value: 0.0000173818),
DataPoint(time: 192, value: 0.0000182746),
DataPoint(time: 193, value: 0.0000202412),
DataPoint(time: 194, value: 0.0000175271),
DataPoint(time: 195, value: 0.0000128524),
DataPoint(time: 196, value: 0.00000707248),
DataPoint(time: 197, value: -0.000000674795),
DataPoint(time: 198, value: -0.00000540378),
DataPoint(time: 199, value: -0.00000437475),
DataPoint(time: 200, value: -0.00000193912),
DataPoint(time: 201, value: -0.00000255399),
DataPoint(time: 202, value: -0.00000803059),
DataPoint(time: 203, value: -0.0000150588),
DataPoint(time: 204, value: -0.0000161427),
DataPoint(time: 205, value: -0.0000125492),
DataPoint(time: 206, value: -0.0000141333),
DataPoint(time: 207, value: -0.0000210874),
DataPoint(time: 208, value: -0.0000254736),
DataPoint(time: 209, value: -0.0000286638),
DataPoint(time: 210, value: -0.0000357909),
DataPoint(time: 211, value: -0.00004251),
DataPoint(time: 212, value: -0.000045894),
DataPoint(time: 213, value: -0.0000520846),
DataPoint(time: 214, value: -0.0000603951),
DataPoint(time: 215, value: -0.000060557),
DataPoint(time: 216, value: -0.0000516115),
DataPoint(time: 217, value: -0.0000434976),
DataPoint(time: 218, value: -0.0000406034),
DataPoint(time: 219, value: -0.0000390841),
DataPoint(time: 220, value: -0.0000355937),
DataPoint(time: 221, value: -0.0000293964),
DataPoint(time: 222, value: -0.000020627),
DataPoint(time: 223, value: -0.0000113636),
DataPoint(time: 224, value: -0.0000069332),
DataPoint(time: 225, value: -0.0000105204),
DataPoint(time: 226, value: -0.0000152412),
DataPoint(time: 227, value: -0.0000117881),
DataPoint(time: 228, value: -0.0000036335),
DataPoint(time: 229, value: -0.000000618217),
DataPoint(time: 230, value: -0.00000220943),
DataPoint(time: 231, value: -0.00000150861),
DataPoint(time: 232, value: 0.00000218001),
DataPoint(time: 233, value: 0.00000623542),
DataPoint(time: 234, value: 0.0000102436),
DataPoint(time: 235, value: 0.0000122885),
DataPoint(time: 236, value: 0.0000106961),
DataPoint(time: 237, value: 0.0000093198),
DataPoint(time: 238, value: 0.0000111315),
DataPoint(time: 239, value: 0.0000131927),
DataPoint(time: 240, value: 0.0000144718),
DataPoint(time: 241, value: 0.0000178729),
DataPoint(time: 242, value: 0.0000217082),
DataPoint(time: 243, value: 0.0000202013),
DataPoint(time: 244, value: 0.0000136507),
DataPoint(time: 245, value: 0.00000927347),
DataPoint(time: 246, value: 0.00000845314),
DataPoint(time: 247, value: 0.00000122998),
DataPoint(time: 248, value: -0.000015632),
DataPoint(time: 249, value: -0.0000257006),
DataPoint(time: 250, value: -0.000015423),
DataPoint(time: 251, value: 0.0000086505),
DataPoint(time: 252, value: 0.0000425839),
DataPoint(time: 253, value: 0.0000951059),
DataPoint(time: 254, value: 0.000163431),
DataPoint(time: 255, value: 0.000235107),
DataPoint(time: 256, value: 0.000310078),
DataPoint(time: 257, value: 0.000383897),
DataPoint(time: 258, value: 0.000431265),
DataPoint(time: 259, value: 0.000440551),
DataPoint(time: 260, value: 0.000434047),
DataPoint(time: 261, value: 0.000430842),
DataPoint(time: 262, value: 0.0004228),
DataPoint(time: 263, value: 0.000396412),
DataPoint(time: 264, value: 0.000337415),
DataPoint(time: 265, value: 0.000210055),
DataPoint(time: 266, value: -0.0000106954),
DataPoint(time: 267, value: -0.000266028),
DataPoint(time: 268, value: -0.000437437),
DataPoint(time: 269, value: -0.000486695),
DataPoint(time: 270, value: -0.000499707),
DataPoint(time: 271, value: -0.000540403),
DataPoint(time: 272, value: -0.000566014),
DataPoint(time: 273, value: -0.000535726),
DataPoint(time: 274, value: -0.000471627),
DataPoint(time: 275, value: -0.000391261),
DataPoint(time: 276, value: -0.000302108),
DataPoint(time: 277, value: -0.000238708),
DataPoint(time: 278, value: -0.000224056),
DataPoint(time: 279, value: -0.000239901),
DataPoint(time: 280, value: -0.000255982),
DataPoint(time: 281, value: -0.000246178),
DataPoint(time: 282, value: -0.000197825),
DataPoint(time: 283, value: -0.000130274),
DataPoint(time: 284, value: -0.0000764891),
DataPoint(time: 285, value: -0.0000492686),
DataPoint(time: 286, value: -0.0000449077),
DataPoint(time: 287, value: -0.000056931),
DataPoint(time: 288, value: -0.0000716623),
DataPoint(time: 289, value: -0.0000707922),
DataPoint(time: 290, value: -0.0000461258),
DataPoint(time: 291, value: -0.00000562529),
DataPoint(time: 292, value: 0.0000337315),
DataPoint(time: 293, value: 0.0000590003),
DataPoint(time: 294, value: 0.0000670806),
DataPoint(time: 295, value: 0.0000606791),
DataPoint(time: 296, value: 0.0000488289),
DataPoint(time: 297, value: 0.0000455181),
DataPoint(time: 298, value: 0.0000567565),
DataPoint(time: 299, value: 0.0000770437),
DataPoint(time: 300, value: 0.0000992687),
DataPoint(time: 301, value: 0.000117732),
DataPoint(time: 302, value: 0.000127203),
DataPoint(time: 303, value: 0.000125566),
DataPoint(time: 304, value: 0.000114892),
DataPoint(time: 305, value: 0.00010366),
DataPoint(time: 306, value: 0.000103174),
DataPoint(time: 307, value: 0.000112791),
DataPoint(time: 308, value: 0.0001212),
DataPoint(time: 309, value: 0.000124782),
DataPoint(time: 310, value: 0.000125795),
DataPoint(time: 311, value: 0.000120962),
DataPoint(time: 312, value: 0.000110711),
DataPoint(time: 313, value: 0.000103583),
DataPoint(time: 314, value: 0.000100471),
DataPoint(time: 315, value: 0.0000941346),
DataPoint(time: 316, value: 0.0000856296),
DataPoint(time: 317, value: 0.0000819542),
DataPoint(time: 318, value: 0.0000813251),
DataPoint(time: 319, value: 0.0000759923),
DataPoint(time: 320, value: 0.0000665149),
DataPoint(time: 321, value: 0.0000605345),
DataPoint(time: 322, value: 0.0000579103),
DataPoint(time: 323, value: 0.0000522307),
DataPoint(time: 324, value: 0.0000450665),
DataPoint(time: 325, value: 0.0000419569),
DataPoint(time: 326, value: 0.0000423074),
DataPoint(time: 327, value: 0.0000434272),
DataPoint(time: 328, value: 0.0000418289),
DataPoint(time: 329, value: 0.0000335223),
DataPoint(time: 330, value: 0.0000233416),
DataPoint(time: 331, value: 0.0000198757),
DataPoint(time: 332, value: 0.0000209673),
DataPoint(time: 333, value: 0.0000200332),
DataPoint(time: 334, value: 0.0000152399),
DataPoint(time: 335, value: 0.00000575563),
DataPoint(time: 336, value: -0.00000450359),
DataPoint(time: 337, value: -0.00000580241),
DataPoint(time: 338, value: 0.00000227206),
DataPoint(time: 339, value: 0.00000848925),
DataPoint(time: 340, value: 0.00000660136),
DataPoint(time: 341, value: -0.000000092605),
DataPoint(time: 342, value: -0.00000732571),
DataPoint(time: 343, value: -0.0000112121),
DataPoint(time: 344, value: -0.00000906004),
DataPoint(time: 345, value: -0.0000055459),
DataPoint(time: 346, value: -0.00000704689),
DataPoint(time: 347, value: -0.0000110283),
DataPoint(time: 348, value: -0.000012996),
DataPoint(time: 349, value: -0.0000154839),
DataPoint(time: 350, value: -0.0000205482),
DataPoint(time: 351, value: -0.0000245482),
DataPoint(time: 352, value: -0.0000250976),
DataPoint(time: 353, value: -0.0000233055),
DataPoint(time: 354, value: -0.0000188888),
DataPoint(time: 355, value: -0.0000113042),
DataPoint(time: 356, value: -0.00000477919),
DataPoint(time: 357, value: -0.00000490122),
DataPoint(time: 358, value: -0.0000102654),
DataPoint(time: 359, value: -0.000013642),
DataPoint(time: 360, value: -0.0000114481),
DataPoint(time: 361, value: -0.00000607219),
DataPoint(time: 362, value: 0.00000108526),
DataPoint(time: 363, value: 0.00000999987),
DataPoint(time: 364, value: 0.0000158073),
DataPoint(time: 365, value: 0.0000147756),
DataPoint(time: 366, value: 0.0000117461),
DataPoint(time: 367, value: 0.00000950839),
DataPoint(time: 368, value: 0.00000428091),
DataPoint(time: 369, value: -0.00000118015),
DataPoint(time: 370, value: 0.00000121732),
DataPoint(time: 371, value: 0.00000901331),
DataPoint(time: 372, value: 0.0000120608),
DataPoint(time: 373, value: 0.0000101622),
DataPoint(time: 374, value: 0.0000115425),
DataPoint(time: 375, value: 0.0000153949),
DataPoint(time: 376, value: 0.0000136556),
DataPoint(time: 377, value: 0.00000715352),
DataPoint(time: 378, value: 0.00000277851),
DataPoint(time: 379, value: 0.00000104278),
DataPoint(time: 380, value: -0.000000734577),
DataPoint(time: 381, value: -0.00000237923),
DataPoint(time: 382, value: -0.00000425378),
DataPoint(time: 383, value: -0.00000710414),
DataPoint(time: 384, value: -0.00000820103),
DataPoint(time: 385, value: -0.00000555017),
DataPoint(time: 386, value: -0.00000338347),
DataPoint(time: 387, value: -0.00000592701),
DataPoint(time: 388, value: -0.00000972449),
DataPoint(time: 389, value: -0.0000108345),
DataPoint(time: 390, value: -0.0000122473),
DataPoint(time: 391, value: -0.0000167298),
DataPoint(time: 392, value: -0.0000231834),
DataPoint(time: 393, value: -0.0000303836),
DataPoint(time: 394, value: -0.0000345184),
DataPoint(time: 395, value: -0.0000329474),
DataPoint(time: 396, value: -0.000033212),
DataPoint(time: 397, value: -0.0000415791),
DataPoint(time: 398, value: -0.000051136),
DataPoint(time: 399, value: -0.0000579596),
DataPoint(time: 400, value: -0.0000686439),
DataPoint(time: 401, value: -0.0000811931),
DataPoint(time: 402, value: -0.0000867568),
DataPoint(time: 403, value: -0.0000905618),
DataPoint(time: 404, value: -0.000100581),
DataPoint(time: 405, value: -0.000107946),
DataPoint(time: 406, value: -0.000107058),
DataPoint(time: 407, value: -0.000110312),
DataPoint(time: 408, value: -0.000121702),
DataPoint(time: 409, value: -0.000128276),
DataPoint(time: 410, value: -0.000125958),
DataPoint(time: 411, value: -0.000121884),
DataPoint(time: 412, value: -0.00011665),
DataPoint(time: 413, value: -0.000108965),
DataPoint(time: 414, value: -0.000103811),
DataPoint(time: 415, value: -0.000101503),
DataPoint(time: 416, value: -0.0000961048),
DataPoint(time: 417, value: -0.000088158),
DataPoint(time: 418, value: -0.0000808367),
DataPoint(time: 419, value: -0.0000704113),
DataPoint(time: 420, value: -0.0000558728),
DataPoint(time: 421, value: -0.0000432303),
DataPoint(time: 422, value: -0.0000327102),
DataPoint(time: 423, value: -0.0000206855),
DataPoint(time: 424, value: -0.0000109501),
DataPoint(time: 425, value: -0.00000580124),
DataPoint(time: 426, value: 0.000000677099),
DataPoint(time: 427, value: 0.0000101642),
DataPoint(time: 428, value: 0.0000196132),
DataPoint(time: 429, value: 0.000030971),
DataPoint(time: 430, value: 0.0000453342),
DataPoint(time: 431, value: 0.0000580941),
DataPoint(time: 432, value: 0.0000667914),
DataPoint(time: 433, value: 0.0000731271),
DataPoint(time: 434, value: 0.0000786488),
DataPoint(time: 435, value: 0.0000835256),
DataPoint(time: 436, value: 0.0000866893),
DataPoint(time: 437, value: 0.0000883398),
DataPoint(time: 438, value: 0.0000909789),
DataPoint(time: 439, value: 0.0000938295),
DataPoint(time: 440, value: 0.000092725),
DataPoint(time: 441, value: 0.0000885973),
DataPoint(time: 442, value: 0.0000871851),
DataPoint(time: 443, value: 0.0000897204),
DataPoint(time: 444, value: 0.0000917043),
DataPoint(time: 445, value: 0.0000909509),
DataPoint(time: 446, value: 0.0000912818),
DataPoint(time: 447, value: 0.0000955525),
DataPoint(time: 448, value: 0.000098516),
DataPoint(time: 449, value: 0.0000934354),
DataPoint(time: 450, value: 0.0000845575),
DataPoint(time: 451, value: 0.0000820102),
DataPoint(time: 452, value: 0.0000838065),
DataPoint(time: 453, value: 0.0000796328),
DataPoint(time: 454, value: 0.0000724229),
DataPoint(time: 455, value: 0.0000716175),
DataPoint(time: 456, value: 0.0000702668),
DataPoint(time: 457, value: 0.0000603499),
DataPoint(time: 458, value: 0.0000542123),
DataPoint(time: 459, value: 0.0000582017),
DataPoint(time: 460, value: 0.0000561252),
DataPoint(time: 461, value: 0.0000436224),
DataPoint(time: 462, value: 0.0000376582),
DataPoint(time: 463, value: 0.0000401386),
DataPoint(time: 464, value: 0.0000345926),
DataPoint(time: 465, value: 0.0000208937),
DataPoint(time: 466, value: 0.0000158107),
DataPoint(time: 467, value: 0.0000204938),
DataPoint(time: 468, value: 0.0000200314),
DataPoint(time: 469, value: 0.0000124696),
DataPoint(time: 470, value: 0.00000763208),
DataPoint(time: 471, value: 0.00000481668),
DataPoint(time: 472, value: -0.000000435068),
DataPoint(time: 473, value: -0.00000335212),
DataPoint(time: 474, value: -0.00000278103),
DataPoint(time: 475, value: -0.00000460619),
DataPoint(time: 476, value: -0.00000802231),
DataPoint(time: 477, value: -0.00000963834),
DataPoint(time: 478, value: -0.000011778),
DataPoint(time: 479, value: -0.0000142481),
DataPoint(time: 480, value: -0.000013345),
DataPoint(time: 481, value: -0.0000106545),
DataPoint(time: 482, value: -0.00000987131),
DataPoint(time: 483, value: -0.0000106081),
DataPoint(time: 484, value: -0.0000115439),
DataPoint(time: 485, value: -0.0000125545),
DataPoint(time: 486, value: -0.0000140081),
DataPoint(time: 487, value: -0.0000175273),
DataPoint(time: 488, value: -0.0000237716),
DataPoint(time: 489, value: -0.0000298462),
DataPoint(time: 490, value: -0.0000323575),
DataPoint(time: 491, value: -0.0000319819),
DataPoint(time: 492, value: -0.0000321214),
DataPoint(time: 493, value: -0.0000328284),
DataPoint(time: 494, value: -0.0000308164),
DataPoint(time: 495, value: -0.0000260697),
DataPoint(time: 496, value: -0.000022892),
DataPoint(time: 497, value: -0.0000248183),
DataPoint(time: 498, value: -0.000029895),
DataPoint(time: 499, value: -0.0000311473),
DataPoint(time: 500, value: -0.0000268147),
DataPoint(time: 501, value: -0.0000242023),
DataPoint(time: 502, value: -0.000025643),
DataPoint(time: 503, value: -0.0000256161),
DataPoint(time: 504, value: -0.0000241477),
DataPoint(time: 505, value: -0.0000235471),
DataPoint(time: 506, value: -0.0000207319),
DataPoint(time: 507, value: -0.000017425),
DataPoint(time: 508, value: -0.0000198299),
DataPoint(time: 509, value: -0.0000245904),
DataPoint(time: 510, value: -0.0000251631),
DataPoint(time: 511, value: -0.0000252495),
DataPoint(time: 512, value: -0.0000287714),
DataPoint(time: 513, value: -0.0000296084),
DataPoint(time: 514, value: -0.0000241484),
DataPoint(time: 515, value: -0.0000185517),
DataPoint(time: 516, value: -0.0000166464),
DataPoint(time: 517, value: -0.0000160246),
DataPoint(time: 518, value: -0.0000154442),
DataPoint(time: 519, value: -0.0000141726),
DataPoint(time: 520, value: -0.0000115027),
DataPoint(time: 521, value: -0.0000111383),
DataPoint(time: 522, value: -0.0000152356),
DataPoint(time: 523, value: -0.0000187984),
DataPoint(time: 524, value: -0.0000184617),
DataPoint(time: 525, value: -0.0000161625),
DataPoint(time: 526, value: -0.000012682),
DataPoint(time: 527, value: -0.0000088675),
DataPoint(time: 528, value: -0.00000759918),
DataPoint(time: 529, value: -0.00000808219),
DataPoint(time: 530, value: -0.00000726399),
DataPoint(time: 531, value: -0.00000572407),
DataPoint(time: 532, value: -0.0000039062),
DataPoint(time: 533, value: -0.000000789636),
DataPoint(time: 534, value: 0.000000289397),
DataPoint(time: 535, value: -0.0000022771),
DataPoint(time: 536, value: -0.00000136966),
DataPoint(time: 537, value: 0.00000494865),
DataPoint(time: 538, value: 0.00000657625),
DataPoint(time: 539, value: 0.000000558194),
DataPoint(time: 540, value: -0.00000287752),
DataPoint(time: 541, value: -0.000000106295),
DataPoint(time: 542, value: 0.00000110497),
DataPoint(time: 543, value: -0.00000117018),
DataPoint(time: 544, value: -0.000000157863),
DataPoint(time: 545, value: 0.00000445593),
DataPoint(time: 546, value: 0.00000592333),
DataPoint(time: 547, value: 0.00000476813),
DataPoint(time: 548, value: 0.0000065434),
DataPoint(time: 549, value: 0.00000905501),
DataPoint(time: 550, value: 0.00000898093),
DataPoint(time: 551, value: 0.0000108682),
DataPoint(time: 552, value: 0.0000142921),
DataPoint(time: 553, value: 0.0000110756),
DataPoint(time: 554, value: 0.00000576621),
DataPoint(time: 555, value: 0.000010819),
DataPoint(time: 556, value: 0.0000197693),
DataPoint(time: 557, value: 0.0000197651),
DataPoint(time: 558, value: 0.0000192134),
DataPoint(time: 559, value: 0.0000287998),
DataPoint(time: 560, value: 0.0000387983),
DataPoint(time: 561, value: 0.000039057),
DataPoint(time: 562, value: 0.0000340426),
DataPoint(time: 563, value: 0.0000298376),
DataPoint(time: 564, value: 0.0000282742),
DataPoint(time: 565, value: 0.000031225),
DataPoint(time: 566, value: 0.0000368781),
DataPoint(time: 567, value: 0.0000374842),
DataPoint(time: 568, value: 0.0000294421),
DataPoint(time: 569, value: 0.0000201397),
DataPoint(time: 570, value: 0.0000173459),
DataPoint(time: 571, value: 0.0000176991),
DataPoint(time: 572, value: 0.0000146323),
DataPoint(time: 573, value: 0.0000105302),
DataPoint(time: 574, value: 0.00000913459),
DataPoint(time: 575, value: 0.00000587692),
DataPoint(time: 576, value: -0.000000581607),
DataPoint(time: 577, value: -0.00000293467),
DataPoint(time: 578, value: -0.00000152846),
DataPoint(time: 579, value: -0.00000350953),
DataPoint(time: 580, value: -0.00000587799),
DataPoint(time: 581, value: -0.00000463024),
DataPoint(time: 582, value: -0.00000747897),
DataPoint(time: 583, value: -0.0000179427),
DataPoint(time: 584, value: -0.0000290094),
DataPoint(time: 585, value: -0.000038893),
DataPoint(time: 586, value: -0.0000489517),
DataPoint(time: 587, value: -0.0000533785),
DataPoint(time: 588, value: -0.0000511712),
DataPoint(time: 589, value: -0.0000522784),
DataPoint(time: 590, value: -0.0000587755),
DataPoint(time: 591, value: -0.0000602584),
DataPoint(time: 592, value: -0.0000542808),
DataPoint(time: 593, value: -0.0000502383),
DataPoint(time: 594, value: -0.0000507646),
DataPoint(time: 595, value: -0.0000475927),
DataPoint(time: 596, value: -0.000037888),
DataPoint(time: 597, value: -0.0000306988),
DataPoint(time: 598, value: -0.000031352),
DataPoint(time: 599, value: -0.0000314258),
DataPoint(time: 600, value: -0.0000241438),
DataPoint(time: 601, value: -0.0000157154),
DataPoint(time: 602, value: -0.0000114591),
DataPoint(time: 603, value: -0.00000758545),
DataPoint(time: 604, value: -0.00000226024),
DataPoint(time: 605, value: 0.00000168026),
DataPoint(time: 606, value: 0.00000460565),
DataPoint(time: 607, value: 0.00000816461),
DataPoint(time: 608, value: 0.0000102899),
DataPoint(time: 609, value: 0.0000100501),
DataPoint(time: 610, value: 0.0000114834),
DataPoint(time: 611, value: 0.00001742),
DataPoint(time: 612, value: 0.0000241285),
DataPoint(time: 613, value: 0.0000267394),
DataPoint(time: 614, value: 0.0000261846),
DataPoint(time: 615, value: 0.0000255129),
DataPoint(time: 616, value: 0.0000249867),
DataPoint(time: 617, value: 0.0000250094),
DataPoint(time: 618, value: 0.0000251969),
DataPoint(time: 619, value: 0.0000217036),
DataPoint(time: 620, value: 0.0000147867),
DataPoint(time: 621, value: 0.00000996591),
DataPoint(time: 622, value: 0.00000650174),
DataPoint(time: 623, value: -0.00000158704),
DataPoint(time: 624, value: -0.0000148501),
DataPoint(time: 625, value: -0.000028215),
DataPoint(time: 626, value: -0.0000336699),
DataPoint(time: 627, value: -0.0000228229),
DataPoint(time: 628, value: 0.00000731547),
DataPoint(time: 629, value: 0.0000562762),
DataPoint(time: 630, value: 0.000121997),
DataPoint(time: 631, value: 0.000197303),
DataPoint(time: 632, value: 0.000278008),
DataPoint(time: 633, value: 0.000362728),
DataPoint(time: 634, value: 0.000432319),
DataPoint(time: 635, value: 0.000461269),
DataPoint(time: 636, value: 0.000456924),
DataPoint(time: 637, value: 0.000449057),
DataPoint(time: 638, value: 0.000443769),
DataPoint(time: 639, value: 0.000425664),
DataPoint(time: 640, value: 0.000389239),
DataPoint(time: 641, value: 0.000319275),
DataPoint(time: 642, value: 0.000164548),
DataPoint(time: 643, value: -0.0000907332),
DataPoint(time: 644, value: -0.000344491),
DataPoint(time: 645, value: -0.000471222),
DataPoint(time: 646, value: -0.000491592),
DataPoint(time: 647, value: -0.000520754),
DataPoint(time: 648, value: -0.000573748),
DataPoint(time: 649, value: -0.000578133),
DataPoint(time: 650, value: -0.000525086),
DataPoint(time: 651, value: -0.000452467),
DataPoint(time: 652, value: -0.000363109),
DataPoint(time: 653, value: -0.000270263),
DataPoint(time: 654, value: -0.000222249),
DataPoint(time: 655, value: -0.000231318),
DataPoint(time: 656, value: -0.000259094),
DataPoint(time: 657, value: -0.000269374),
DataPoint(time: 658, value: -0.000247963),
DataPoint(time: 659, value: -0.000196166),
DataPoint(time: 660, value: -0.000130116),
DataPoint(time: 661, value: -0.0000751574),
DataPoint(time: 662, value: -0.000051416),
DataPoint(time: 663, value: -0.0000583358),
DataPoint(time: 664, value: -0.0000757485),
DataPoint(time: 665, value: -0.0000845339),
DataPoint(time: 666, value: -0.0000751096),
DataPoint(time: 667, value: -0.0000419801),
DataPoint(time: 668, value: 0.00000773919),
DataPoint(time: 669, value: 0.0000513699),
DataPoint(time: 670, value: 0.0000723113),
DataPoint(time: 671, value: 0.0000707312),
DataPoint(time: 672, value: 0.0000548351),
DataPoint(time: 673, value: 0.0000388868),
DataPoint(time: 674, value: 0.0000370714),
DataPoint(time: 675, value: 0.0000498067),
DataPoint(time: 676, value: 0.0000703158),
DataPoint(time: 677, value: 0.00009495),
DataPoint(time: 678, value: 0.000113483),
DataPoint(time: 679, value: 0.00011303),
DataPoint(time: 680, value: 0.0000996448),
DataPoint(time: 681, value: 0.0000907797),
DataPoint(time: 682, value: 0.0000907419),
DataPoint(time: 683, value: 0.0000945034),
DataPoint(time: 684, value: 0.000101184),
DataPoint(time: 685, value: 0.000109679),
DataPoint(time: 686, value: 0.000115282),
DataPoint(time: 687, value: 0.000114217),
DataPoint(time: 688, value: 0.000106093),
DataPoint(time: 689, value: 0.0000974965),
DataPoint(time: 690, value: 0.0000966723),
DataPoint(time: 691, value: 0.0000987091),
DataPoint(time: 692, value: 0.0000938853),
DataPoint(time: 693, value: 0.0000881382),
DataPoint(time: 694, value: 0.0000903753),
DataPoint(time: 695, value: 0.0000927378),
DataPoint(time: 696, value: 0.0000871216),
DataPoint(time: 697, value: 0.000080033),
DataPoint(time: 698, value: 0.0000756494),
DataPoint(time: 699, value: 0.000069088),
DataPoint(time: 700, value: 0.0000620156),
DataPoint(time: 701, value: 0.0000608485),
DataPoint(time: 702, value: 0.0000620601),
DataPoint(time: 703, value: 0.0000589183),
DataPoint(time: 704, value: 0.0000538964),
DataPoint(time: 705, value: 0.0000505865),
DataPoint(time: 706, value: 0.0000464459),
DataPoint(time: 707, value: 0.0000415196),
DataPoint(time: 708, value: 0.0000387594),
DataPoint(time: 709, value: 0.0000337234),
DataPoint(time: 710, value: 0.0000217968),
DataPoint(time: 711, value: 0.0000115693),
DataPoint(time: 712, value: 0.0000123818),
DataPoint(time: 713, value: 0.0000185559),
DataPoint(time: 714, value: 0.0000215628),
DataPoint(time: 715, value: 0.000022378),
DataPoint(time: 716, value: 0.0000212639),
DataPoint(time: 717, value: 0.0000131465),
DataPoint(time: 718, value: -0.00000122084),
DataPoint(time: 719, value: -0.0000140063),
DataPoint(time: 720, value: -0.0000196848),
DataPoint(time: 721, value: -0.000017575),
DataPoint(time: 722, value: -0.0000110136),
DataPoint(time: 723, value: -0.00000635122),
DataPoint(time: 724, value: -0.00000641963),
DataPoint(time: 725, value: -0.00000770434),
DataPoint(time: 726, value: -0.00000788549),
DataPoint(time: 727, value: -0.000010307),
DataPoint(time: 728, value: -0.0000168375),
DataPoint(time: 729, value: -0.0000213767),
DataPoint(time: 730, value: -0.0000180815),
DataPoint(time: 731, value: -0.0000121933),
DataPoint(time: 732, value: -0.0000106059),
DataPoint(time: 733, value: -0.00000991964),
DataPoint(time: 734, value: -0.00000813703),
DataPoint(time: 735, value: -0.0000104527),
DataPoint(time: 736, value: -0.0000142419),
DataPoint(time: 737, value: -0.0000132893),
DataPoint(time: 738, value: -0.0000122271),
DataPoint(time: 739, value: -0.0000131117),
DataPoint(time: 740, value: -0.00000832198),
DataPoint(time: 741, value: -0.000000782834),
DataPoint(time: 742, value: -0.00000183495),
DataPoint(time: 743, value: -0.00000819773),
DataPoint(time: 744, value: -0.00000877623),
DataPoint(time: 745, value: -0.00000456923),
DataPoint(time: 746, value: -0.00000226393),
DataPoint(time: 747, value: -0.000000937009),
DataPoint(time: 748, value: 0.00000324865),
DataPoint(time: 749, value: 0.00000714484),
DataPoint(time: 750, value: 0.00000400854),
DataPoint(time: 751, value: -0.00000393466),
DataPoint(time: 752, value: -0.00000678885),
DataPoint(time: 753, value: -0.00000326854),
DataPoint(time: 754, value: -0.0000012712),
DataPoint(time: 755, value: -0.0000018871),
DataPoint(time: 756, value: 0.000000239934),
DataPoint(time: 757, value: 0.00000363149),
DataPoint(time: 758, value: 0.00000197971),
DataPoint(time: 759, value: -0.00000454794),
DataPoint(time: 760, value: -0.00000951184),
DataPoint(time: 761, value: -0.0000100362),
DataPoint(time: 762, value: -0.0000102876),
DataPoint(time: 763, value: -0.000012737),
DataPoint(time: 764, value: -0.0000132215),
DataPoint(time: 765, value: -0.0000106311),
DataPoint(time: 766, value: -0.000011924),
DataPoint(time: 767, value: -0.0000199816),
DataPoint(time: 768, value: -0.0000280799),
DataPoint(time: 769, value: -0.0000330633),
DataPoint(time: 770, value: -0.0000387048),
DataPoint(time: 771, value: -0.0000436223),
DataPoint(time: 772, value: -0.000044437),
DataPoint(time: 773, value: -0.0000459174),
DataPoint(time: 774, value: -0.0000522357),
DataPoint(time: 775, value: -0.0000601918),
DataPoint(time: 776, value: -0.0000680088),
DataPoint(time: 777, value: -0.0000763694),
DataPoint(time: 778, value: -0.0000826389),
DataPoint(time: 779, value: -0.0000858746),
DataPoint(time: 780, value: -0.0000912728),
DataPoint(time: 781, value: -0.000102215),
DataPoint(time: 782, value: -0.00011367),
DataPoint(time: 783, value: -0.000118234),
DataPoint(time: 784, value: -0.000116703),
DataPoint(time: 785, value: -0.000117905),
DataPoint(time: 786, value: -0.000125299),
DataPoint(time: 787, value: -0.000130182),
DataPoint(time: 788, value: -0.000125525),
DataPoint(time: 789, value: -0.000116987),
DataPoint(time: 790, value: -0.000109685),
DataPoint(time: 791, value: -0.000100547),
DataPoint(time: 792, value: -0.0000928807),
DataPoint(time: 793, value: -0.0000917489),
DataPoint(time: 794, value: -0.0000862179),
DataPoint(time: 795, value: -0.0000696274),
DataPoint(time: 796, value: -0.0000569475),
DataPoint(time: 797, value: -0.0000525745),
DataPoint(time: 798, value: -0.0000407798),
DataPoint(time: 799, value: -0.0000217203),
DataPoint(time: 800, value: -0.00000868878),
DataPoint(time: 801, value: 0.000000974235),
DataPoint(time: 802, value: 0.0000120796),
DataPoint(time: 803, value: 0.0000190072),
DataPoint(time: 804, value: 0.0000259823),
DataPoint(time: 805, value: 0.0000414228),
DataPoint(time: 806, value: 0.0000572114),
DataPoint(time: 807, value: 0.0000648293),
DataPoint(time: 808, value: 0.0000696921),
DataPoint(time: 809, value: 0.0000751025),
DataPoint(time: 810, value: 0.0000791923),
DataPoint(time: 811, value: 0.0000844264),
DataPoint(time: 812, value: 0.0000901733),
DataPoint(time: 813, value: 0.0000919795),
DataPoint(time: 814, value: 0.0000947187),
DataPoint(time: 815, value: 0.00010426),
DataPoint(time: 816, value: 0.000111899),
DataPoint(time: 817, value: 0.000109195),
DataPoint(time: 818, value: 0.00010426),
DataPoint(time: 819, value: 0.000105901),
DataPoint(time: 820, value: 0.000109695),
DataPoint(time: 821, value: 0.000109819),
DataPoint(time: 822, value: 0.000107904),
DataPoint(time: 823, value: 0.000106952),
DataPoint(time: 824, value: 0.000105759),
DataPoint(time: 825, value: 0.000100802),
DataPoint(time: 826, value: 0.0000940059),
DataPoint(time: 827, value: 0.0000915684),
DataPoint(time: 828, value: 0.0000898204),
DataPoint(time: 829, value: 0.0000799832),
DataPoint(time: 830, value: 0.0000684058),
DataPoint(time: 831, value: 0.0000651553),
DataPoint(time: 832, value: 0.0000629235),
DataPoint(time: 833, value: 0.000055767),
DataPoint(time: 834, value: 0.0000538728),
DataPoint(time: 835, value: 0.0000578803),
DataPoint(time: 836, value: 0.0000532044),
DataPoint(time: 837, value: 0.0000403282),
DataPoint(time: 838, value: 0.0000339559),
DataPoint(time: 839, value: 0.0000338858),
DataPoint(time: 840, value: 0.0000297047),
DataPoint(time: 841, value: 0.0000231183),
DataPoint(time: 842, value: 0.0000215162),
DataPoint(time: 843, value: 0.0000234628),
DataPoint(time: 844, value: 0.0000227127),
DataPoint(time: 845, value: 0.0000173724),
DataPoint(time: 846, value: 0.0000113057),
DataPoint(time: 847, value: 0.00000742501),
DataPoint(time: 848, value: 0.00000331638),
DataPoint(time: 849, value: -0.00000177502),
DataPoint(time: 850, value: -0.00000400684),
DataPoint(time: 851, value: -0.00000341488),
DataPoint(time: 852, value: -0.0000041086),
DataPoint(time: 853, value: -0.00000683481),
DataPoint(time: 854, value: -0.0000103873),
DataPoint(time: 855, value: -0.0000140609),
DataPoint(time: 856, value: -0.0000164165),
DataPoint(time: 857, value: -0.0000183087),
DataPoint(time: 858, value: -0.0000217672),
DataPoint(time: 859, value: -0.0000250024),
DataPoint(time: 860, value: -0.0000266936),
DataPoint(time: 861, value: -0.0000284367),
DataPoint(time: 862, value: -0.0000290138),
DataPoint(time: 863, value: -0.0000271166),
DataPoint(time: 864, value: -0.0000262087),
DataPoint(time: 865, value: -0.0000283796),
DataPoint(time: 866, value: -0.0000321296),
DataPoint(time: 867, value: -0.0000362135),
DataPoint(time: 868, value: -0.0000374004),
DataPoint(time: 869, value: -0.0000337584),
DataPoint(time: 870, value: -0.0000316278),
DataPoint(time: 871, value: -0.0000349383),
DataPoint(time: 872, value: -0.0000363148),
DataPoint(time: 873, value: -0.0000323251),
DataPoint(time: 874, value: -0.0000306282),
DataPoint(time: 875, value: -0.0000333521),
DataPoint(time: 876, value: -0.0000334066),
DataPoint(time: 877, value: -0.0000303871),
DataPoint(time: 878, value: -0.0000315571),
DataPoint(time: 879, value: -0.0000370316),
DataPoint(time: 880, value: -0.0000386638),
DataPoint(time: 881, value: -0.000033453),
DataPoint(time: 882, value: -0.0000275933),
DataPoint(time: 883, value: -0.0000264576),
DataPoint(time: 884, value: -0.0000278754),
DataPoint(time: 885, value: -0.0000280191),
DataPoint(time: 886, value: -0.0000280556),
DataPoint(time: 887, value: -0.0000289845),
DataPoint(time: 888, value: -0.000027464),
DataPoint(time: 889, value: -0.0000243315),
DataPoint(time: 890, value: -0.000025009),
DataPoint(time: 891, value: -0.0000276865),
DataPoint(time: 892, value: -0.0000264142),
DataPoint(time: 893, value: -0.0000215232),
DataPoint(time: 894, value: -0.0000148684),
DataPoint(time: 895, value: -0.00000751556),
DataPoint(time: 896, value: -0.00000543741),
DataPoint(time: 897, value: -0.00000978639),
DataPoint(time: 898, value: -0.0000102031),
DataPoint(time: 899, value: -0.00000445788),
DataPoint(time: 900, value: -0.00000342492),
DataPoint(time: 901, value: -0.00000720986),
DataPoint(time: 902, value: -0.00000566629),
DataPoint(time: 903, value: -0.00000139502),
DataPoint(time: 904, value: -0.00000298482),
DataPoint(time: 905, value: -0.00000545604),
DataPoint(time: 906, value: -0.00000117806),
DataPoint(time: 907, value: 0.00000443338),
DataPoint(time: 908, value: 0.00000501959),
DataPoint(time: 909, value: 0.0000046736),
DataPoint(time: 910, value: 0.00000684219),
DataPoint(time: 911, value: 0.00000828312),
DataPoint(time: 912, value: 0.0000086872),
DataPoint(time: 913, value: 0.0000108364),
DataPoint(time: 914, value: 0.0000118464),
DataPoint(time: 915, value: 0.00000847381),
DataPoint(time: 916, value: 0.00000549034),
DataPoint(time: 917, value: 0.0000065119),
DataPoint(time: 918, value: 0.00000689094),
DataPoint(time: 919, value: 0.00000554972),
DataPoint(time: 920, value: 0.00000877261),
DataPoint(time: 921, value: 0.0000145246),
DataPoint(time: 922, value: 0.0000131757),
DataPoint(time: 923, value: 0.00000752177),
DataPoint(time: 924, value: 0.00000755986),
DataPoint(time: 925, value: 0.00000990749),
DataPoint(time: 926, value: 0.00000715955),
DataPoint(time: 927, value: 0.0000037283),
DataPoint(time: 928, value: 0.00000395016),
DataPoint(time: 929, value: 0.00000415446),
DataPoint(time: 930, value: 0.00000428772),
DataPoint(time: 931, value: 0.00000740694),
DataPoint(time: 932, value: 0.0000105916),
DataPoint(time: 933, value: 0.0000112359),
DataPoint(time: 934, value: 0.0000117885),
DataPoint(time: 935, value: 0.0000125221),
DataPoint(time: 936, value: 0.0000129478),
DataPoint(time: 937, value: 0.0000166375),
DataPoint(time: 938, value: 0.0000234426),
DataPoint(time: 939, value: 0.0000270445),
DataPoint(time: 940, value: 0.0000258957),
DataPoint(time: 941, value: 0.0000249331),
DataPoint(time: 942, value: 0.0000271581),
DataPoint(time: 943, value: 0.0000309743),
DataPoint(time: 944, value: 0.0000315425),
DataPoint(time: 945, value: 0.0000259603),
DataPoint(time: 946, value: 0.0000199549),
DataPoint(time: 947, value: 0.0000199919),
DataPoint(time: 948, value: 0.0000208899),
DataPoint(time: 949, value: 0.000015288),
DataPoint(time: 950, value: 0.00000847226),
DataPoint(time: 951, value: 0.00000830606),
DataPoint(time: 952, value: 0.00000996718),
DataPoint(time: 953, value: 0.00000559066),
DataPoint(time: 954, value: -0.00000130654),
DataPoint(time: 955, value: -0.00000414074),
DataPoint(time: 956, value: -0.00000565993),
DataPoint(time: 957, value: -0.0000110388),
DataPoint(time: 958, value: -0.0000187887),
DataPoint(time: 959, value: -0.0000258808),
DataPoint(time: 960, value: -0.0000315792),
DataPoint(time: 961, value: -0.0000345766),
DataPoint(time: 962, value: -0.0000346591),
DataPoint(time: 963, value: -0.000034536),
DataPoint(time: 964, value: -0.0000368959),
DataPoint(time: 965, value: -0.0000413828),
DataPoint(time: 966, value: -0.0000444165),
DataPoint(time: 967, value: -0.0000451213),
DataPoint(time: 968, value: -0.0000467731),
DataPoint(time: 969, value: -0.0000466414),
DataPoint(time: 970, value: -0.0000394901),
DataPoint(time: 971, value: -0.0000322083),
DataPoint(time: 972, value: -0.0000328444),
DataPoint(time: 973, value: -0.0000346396),
DataPoint(time: 974, value: -0.000030902),
DataPoint(time: 975, value: -0.0000271112),
DataPoint(time: 976, value: -0.0000269864),
DataPoint(time: 977, value: -0.000026407),
DataPoint(time: 978, value: -0.0000232447),
DataPoint(time: 979, value: -0.000018943),
DataPoint(time: 980, value: -0.0000141362),
DataPoint(time: 981, value: -0.00000963697),
DataPoint(time: 982, value: -0.00000586424),
DataPoint(time: 983, value: -0.000000582856),
DataPoint(time: 984, value: 0.00000654899),
DataPoint(time: 985, value: 0.000010602),
DataPoint(time: 986, value: 0.00000941726),
DataPoint(time: 987, value: 0.00000914014),
DataPoint(time: 988, value: 0.0000132857),
DataPoint(time: 989, value: 0.0000156163),
DataPoint(time: 990, value: 0.0000138885),
DataPoint(time: 991, value: 0.0000159623),
DataPoint(time: 992, value: 0.0000232912),
DataPoint(time: 993, value: 0.0000274178),
DataPoint(time: 994, value: 0.0000260073),
DataPoint(time: 995, value: 0.0000225814),
DataPoint(time: 996, value: 0.0000166979),
DataPoint(time: 997, value: 0.0000112131),
DataPoint(time: 998, value: 0.0000139963),
DataPoint(time: 999, value: 0.0000218289),
        ]
    
    func saveData(data: [DataPoint]) {
        let timestamp = Date().timeIntervalSince1970
        let key = "save_\(timestamp)"
        let nums = data.map(\.value)
        UserDefaults.standard.set(nums, forKey: key)

        var keys = UserDefaults.standard.array(forKey: "savedKeys") as? [String] ?? []
        keys.append(key)
        UserDefaults.standard.set(keys, forKey: "savedKeys")
        loadSavedKeys()
        print("Data saved with key: \(key)")
    }
    
    func deleteData(forKey key: String) {
            UserDefaults.standard.removeObject(forKey: key)

            var keys = UserDefaults.standard.array(forKey: "savedKeys") as? [String] ?? []
            keys.removeAll { $0 == key }  // Remove key from list
            UserDefaults.standard.set(keys, forKey: "savedKeys")

            loadSavedKeys()
            print("Deleted entry: \(key)")
        }
    
    func loadSavedKeys() {
        savedKeys =  UserDefaults.standard.array(forKey: "savedKeys") as? [String] ?? []
    }
    
    func loadData(forKey key: String) {
        if let savedNumbers = UserDefaults.standard.array(forKey: key) as? [Double] {
            selectedData = []
            for(i, num) in savedNumbers.enumerated() {
                selectedData.append(DataPoint(time: Double(i), value: Double(num)))
            }
            selectedKey = key
            print("Loaded \(key)")
        } else {
            print("No data found for key: \(key)")
        }
    }
    
    var body: some View {
        TabView {
            VStack{
                Text("Last ECG")
                Text("January 1, 2024")
                    .font(.caption)
                Chart {
                    ForEach(data) {
                        point in LineMark(
                            x: .value("Time", point.time),
                            y: .value("ECG Value", point.value)
                        )
                        .foregroundStyle(.green)
                        .interpolationMethod(.cardinal)
                    }
                }
                    .frame(height: 300)
                    .padding()
                
                HStack {
                    VStack{
                        Text("Lorem ipsum")
                        Text("dolor sit amet")
                    }
                    .padding(.trailing, 140.0)
                    
                    Button(action: {saveData(data: data)}) {
                        VStack{
                            Image(systemName: "square.and.arrow.down")
                            Text("Save")
                                .textScale(.secondary)
                        }
                    }
                    Button(action: {print("Ipsum")}) {
                        VStack{
                            Image(systemName: "square.and.arrow.up")
                            Text("Export")
                                .textScale(.secondary)
                        }
                    }
                }
            }
                .tabItem {
                    Image(systemName: "house")
                    Text("Home")
                }
            
            Text("Lorem ipsum dolor sit amet, qui minim labore adipisicing minim sint cillum sint consectetur cupidatat.")
                .tabItem {
                    Image(systemName: "clock.fill")
                    Text("Recent")
                }
            NavigationView { // saved data view
                List {
                    ForEach(savedKeys, id: \.self) { key in
                        HStack {
                            Button(action: {
                                loadData(forKey: key)
                            }) {
                            Text("Saved on \(formattedDate(from: Double(key.replacingOccurrences(of: "save_", with: "")) ?? 0))")
                            }
                            Spacer()
                            Button(action: {
                                deleteData(forKey: key)
                            }) {
                                Image(systemName: "trash")
                                    .foregroundColor(.red)
                            }
                            .buttonStyle(BorderlessButtonStyle()) // Ensures button works in List
                        }
                    }
                }
                .navigationTitle("Saved Entries")
                .onAppear {
                    loadSavedKeys()
                }
                .sheet(isPresented: Binding<Bool>(
                            get: { !selectedData.isEmpty },
                            set: { if !$0 { selectedData = [] } }
                        )) {
                            DataDetailView(dataPoints: selectedData, key: selectedKey ?? "ECG")
                        }
            }
                .tabItem {
                    Image(systemName: "folder.fill")
                    Text("Saved")
                }
        }.onAppear{
            startTimer()
        }
    }
}
struct DataDetailView: View {
    var dataPoints: [DataPoint]
    var key: String

    var body: some View {
        VStack{
            Text("\(formattedDate(from: Double(key.replacingOccurrences(of: "save_", with: "")) ?? 0))")
            Chart {
                ForEach(dataPoints) {
                    point in LineMark(
                        x: .value("Time", point.time),
                        y: .value("ECG Value", point.value)
                    )
                    .foregroundStyle(.green)
                    .interpolationMethod(.cardinal)
                }
            }
            .frame(height: 300)
            .padding()
        }
    }
}

#Preview {
    ContentView()
}
